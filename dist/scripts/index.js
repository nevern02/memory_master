var MemoryMaster=angular.module("MemoryMaster",["ngAnimate","ui.bootstrap","ui.router"]);MemoryMaster.config(["$stateProvider","$urlRouterProvider",function(a){a.state("welcome",{controller:"ModalCtrl"}).state("prepare",{controller:"ModalCtrl"}).state("playing",{controller:"PlayingCtrl",templateUrl:"playing.html"}).state("stageComplete",{controller:"ModalCtrl"}).state("gameOver",{controller:"ModalCtrl"})}]),MemoryMaster.factory("ImageList",function(){var a=["red","green","blue","teal","orange","purple","brown","darkcyan","olive","tan","violet"],b=["fa-adjust","fa-anchor","fa-archive","fa-arrows","fa-arrows-h","fa-arrows-v","fa-asterisk","fa-automobile","fa-ban","fa-bank","fa-barcode","fa-bars","fa-beer","fa-bell","fa-bell-o","fa-bolt","fa-bomb","fa-book","fa-bookmark","fa-bookmark-o","fa-briefcase","fa-bug","fa-building","fa-building-o","fa-bullhorn","fa-bullseye","fa-cab","fa-calendar","fa-calendar-o","fa-camera","fa-camera-retro","fa-car","fa-caret-square-o-down","fa-caret-square-o-left","fa-caret-square-o-right","fa-caret-square-o-up","fa-certificate","fa-check","fa-check-circle","fa-check-circle-o","fa-check-square","fa-check-square-o","fa-child","fa-circle","fa-circle-o","fa-circle-o-notch","fa-circle-thin","fa-clock-o","fa-cloud","fa-cloud-download","fa-cloud-upload","fa-code","fa-code-fork","fa-coffee","fa-bar-chart-o","fa-cog","fa-cogs","fa-comment","fa-comment-o","fa-comments"],c=function(c){var d=_.shuffle(b).slice(0,c/2),e=_.map(d,function(b){var c=_.shuffle(a).shift();return{image:b,color:c}});this.images=_.shuffle(e.concat(_.clone(e)))};return c}),MemoryMaster.factory("Card",["ImageList",function(a){var b=["stairs","microbial","horizontal-stripes","rombes","arrows","zig-zag","weave","upholstery","stary","marrakesh","bokeh","carbon","vertical-stripes","carbon-fibre","hearts","argyle","steps","waves","cross","yin-yang","stars","brady-bunch","shippo","bricks","seigaiha","japanese-cube","polka-dot","houndstooth","checkerboard","diagonal-checkerboard","tartan","madras","lined-paper","blueprint-grid","tablecloth","diagonal-stripes","cicada-stripes"],c=function(a){return Math.max(9.5-.5*a,2)+"em"},d=function(a){return Math.max(12.5-.5*a,2)+"em"},e=function(a){return Math.max(6.5-.5*a,1)+"em"},f=function(a){var c=a%b.length-1;return 0>c?b[b.length-1]:b[c]},g=function(a){this.isShowing=!1,this.wasSeen=!1,this.image=a.image,this.color=a.color};return g.newSet=function(b,h){var i=new a(h),j=c(b),k=d(b),l=e(b),m=f(b);return _.map(i.images,function(a){var b=new g(a);return b.width=j,b.height=k,b.fontSize=l,b.pattern=m,b})},g}]),MemoryMaster.service("HighScores",function(){var a=0,b=chrome&&chrome.storage;if(b)chrome.storage.sync.get("highScore",function(b){b.highScore&&(a=b.highScore)});else{var c=document.cookie.replace(/(?:(?:^|.*;\s*)highScore\s*\=\s*([^;]*).*$)|^.*$/,"$1");c.length>0&&(a=parseInt(c))}this.current=function(){return a},this.save=function(c){a=c,b?chrome.storage.sync.set({highScore:c},null):document.cookie="highScore="+a}}),MemoryMaster.service("Score",["Alert",function(a){var b=0,c=1,d=0,e=[],f=function(a){e.unshift(a),e.length>50&&e.pop()},g=function(){c>1&&a.alert("x"+(c+d),"teal")};this.getScore=function(){return b},this.reset=function(){c=1,d=0,b=0,e=[]},this.add=function(a){b+=a*(c+d),e[0]&&(c+=1,g()),f(!0)},this.getTotalMultiplier=function(){return c+d},this.resetMultiplier=function(){c=1,f(!1)},this.setStageMultiplier=function(a){d=a}}]),MemoryMaster.service("Timer",["$interval","$q",function(a,b){var c=300,d=c,e=null,f=null,g=function(){d-=1,f.notify(d),0===d&&(stop(),f.resolve())};this.remaining=function(){return d},this.start=function(){return f=b.defer(),e=a(function(){g()},1e3),f.promise},this.stop=function(){a.cancel(e)},this.reset=function(){d=c},this.subtract=function(a){d-=a},this.add=function(a){d+=a}}]),MemoryMaster.service("Alert",["$timeout",function(a){var b=[],c=0;this.getAlerts=function(){return b},this.alert=function(d,e){var f={text:d,color:e,isShowing:!0},g=500*c;a(function(){b.unshift(f)},g),c+=1,a(function(){c-=1,f.isShowing=!1},g+350)}}]),MemoryMaster.filter("elapsedTime",function(){var a=function(a){return 10>a?"0"+a:a.toString()};return function(b){var c=Math.floor(b/60),b=b%60;return a(c)+":"+a(b)}}),MemoryMaster.controller("GameCtrl",["$scope","$state","HighScores",function(a,b){a.numberOfCards=10,a.stage=1,b.go("welcome"),a.isBrowser=!window.location.protocol.match(/chrome-extension/),a.$on("$stateChangeSuccess",function(b,c,d,e){"prepare"===c.name&&"stageComplete"===e.name?(a.stage+=1,a.numberOfCards+=2):"welcome"==c.name&&(a.stage=1,a.numberOfCards=10)})}]),MemoryMaster.controller("BackgroundCtrl",["$scope",function(a){var b=["city1.jpg","grass1.jpg","car1.jpg","buildings1.jpg","beach1.jpg","cherries1.jpg","water1.jpg","sunset1.jpg","car2.jpg","snow1.jpg","river1.jpg","sunset2.jpg","blossoms1.jpg","tree1.jpg","beach2.jpg","sunset3.jpg","street1.jpg","building1.jpg"],c=function(){var c=a.stage%b.length-1;return 0>c?b[b.length-1]:b[c]};a.$watch("stage",function(b,d){if(b!==d){var e="images/"+c(),f=a.stage%2+1,g=1===f?2:1,h=$("#background"+f),i=$("#background"+g);i.attr("src",e),i.fadeIn(1e3),h.fadeOut(1e3)}})}]),MemoryMaster.controller("ScoreCtrl",["$scope","Score","Alert",function(a,b){a.score=0,a.multiplier=1,a.$watch(function(){return b.getScore()},function(b,c){b!==c&&(a.score=b)}),a.$watch(function(){return b.getTotalMultiplier()},function(b,c){b!==c&&(a.multiplier=b)}),a.$on("cards.match",function(){b.add(10)}),a.$on("cards.miss",function(){b.resetMultiplier()}),a.$on("$stateChangeSuccess",function(a,c){"welcome"===c.name&&b.reset()}),a.$watch("stage",function(c,d){c!==d&&c>d&&b.setStageMultiplier(a.stage-1)})}]),MemoryMaster.controller("TimerCtrl",["$scope","$state","Timer","Alert",function(a,b,c,d){a.remainingSeconds=c.remaining();var e=[];a.$on("cards.match",function(){e[0]&&(c.add(2),d.alert("+2s","green")),f(!0)}),a.$on("cards.miss",function(a,b){b[0].wasSeen&&b[1].wasSeen&&(c.subtract(2),d.alert("-2s","red")),f(!1)}),a.$on("$stateChangeSuccess",function(d,e){switch(e.name){case"playing":c.start().then(function(){b.go("gameOver")},null,function(b){a.remainingSeconds=b});break;case"stageComplete":case"gameOver":c.stop();break;case"welcome":c.reset(),a.remainingSeconds=c.remaining()}});var f=function(a){e.unshift(a),e.length>50&&e.pop()}}]),MemoryMaster.controller("AlertCtrl",["$scope","Alert",function(a,b){a.alerts=[],a.$watch(function(){return b.getAlerts().length},function(c,d){c!==d&&c>d&&(a.alerts=b.getAlerts())})}]),MemoryMaster.controller("ModalCtrl",["$scope","$state","$modal",function(a,b,c){var d=function(a,b){a.close=function(){b.close()},a.dismiss=function(){b.dismiss()}},e=b.current.name+".html",f={templateUrl:e,backdrop:"static",controller:d,scope:a};switch(b.current.name){case"welcome":var g={size:"lg"};c.open($.extend({},g,f)).result.then(function(){b.go("prepare")});break;case"prepare":c.open(f).result.then(function(){b.go("playing")});break;case"stageComplete":a.winning=!0;case"gameOver":a.winning=a.winning||!1;var g={controller:"SummaryCtrl",templateUrl:"summary.html"};c.open($.extend({},f,g)).result.then(function(){b.go("prepare")},function(){b.go("welcome")})}}]),MemoryMaster.controller("PlayingCtrl",["$scope","$rootScope","$state","$timeout","Card",function(a,b,c,d,e){a.currentPair=[],a.cards=e.newSet(a.stage,a.numberOfCards),a.enableClick=!0,a.reveal=function(e){a.enableClick&&!e.isShowing&&(e.isShowing=!0,a.currentPair.push(e),a.currentPair.length>1&&(a.enableClick=!1,g()?(b.$broadcast("cards.match",a.currentPair),f()?c.go("stageComplete"):(a.currentPair=[],a.enableClick=!0)):(b.$broadcast("cards.miss",a.currentPair),d(function(){_.each(a.currentPair,function(a){a.isShowing=!1,a.wasSeen=!0}),a.currentPair=[],a.enableClick=!0},1e3))))};var f=function(){return!_.any(a.cards,function(a){return!a.isShowing})},g=function(){return a.currentPair[0].image===a.currentPair[1].image}}]),MemoryMaster.controller("SummaryCtrl",["$scope","$modalInstance","Score","HighScores","Timer",function(a,b,c,d,e){a.score=c.getScore(),a.remainingTime=e.remaining(),a.highScore=d.current(),a.newHighScore=!1,a.score>a.highScore&&(a.newHighScore=!0,d.save(a.score)),a.close=function(){b.close()},a.dismiss=function(){b.dismiss()}}]);